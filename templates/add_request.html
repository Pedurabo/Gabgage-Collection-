{% extends "base.html" %}

{% block title %}Add Service Request - Garbage Collection & Disposal Firm{% endblock %}

{% block page_title %}Create Service Request{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-plus me-2"></i>New Service Request
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('add_request') }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="customer_id" class="form-label">Customer *</label>
                            <select class="form-select" id="customer_id" name="customer_id" required>
                                <option value="">Select a customer...</option>
                                {% for customer in customers %}
                                <option value="{{ customer.id }}" {% if request.args.get('customer_id')|int == customer.id %}selected{% endif %}>
                                    {{ customer.name }} - {{ customer.email }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="service_type" class="form-label">Service Type *</label>
                            <select class="form-select" id="service_type" name="service_type" required>
                                <option value="">Select service type...</option>
                                <option value="pickup">Garbage Pickup</option>
                                <option value="disposal">Waste Disposal</option>
                                <option value="recycling">Recycling Collection</option>
                                <option value="bulk">Bulk Item Removal</option>
                                <option value="hazardous">Hazardous Waste</option>
                                <option value="special">Special Collection</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="scheduled_date" class="form-label">Scheduled Date *</label>
                            <input type="date" class="form-control" id="scheduled_date" name="scheduled_date" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="priority" class="form-label">Priority</label>
                            <select class="form-select" id="priority" name="priority">
                                <option value="normal">Normal</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12 mb-3">
                            <label for="description" class="form-label">Description *</label>
                            <textarea class="form-control" id="description" name="description" rows="4" placeholder="Describe the service requirements, special instructions, or any additional details..." required></textarea>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="estimated_duration" class="form-label">Estimated Duration (hours)</label>
                            <input type="number" class="form-control" id="estimated_duration" name="estimated_duration" min="0.5" max="24" step="0.5" placeholder="2.5">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vehicle_required" class="form-label">Vehicle Required</label>
                            <select class="form-select" id="vehicle_required" name="vehicle_required">
                                <option value="">Any available vehicle</option>
                                <option value="truck">Truck</option>
                                <option value="compactor">Compactor</option>
                                <option value="van">Van</option>
                                <option value="special">Special Equipment</option>
                            </select>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('requests') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Requests
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Create Request
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>Service Types
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Standard Services</h6>
                        <ul class="text-muted small">
                            <li><strong>Garbage Pickup:</strong> Regular household waste collection</li>
                            <li><strong>Waste Disposal:</strong> General waste disposal services</li>
                            <li><strong>Recycling Collection:</strong> Paper, plastic, metal recycling</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Special Services</h6>
                        <ul class="text-muted small">
                            <li><strong>Bulk Item Removal:</strong> Large furniture, appliances</li>
                            <li><strong>Hazardous Waste:</strong> Chemicals, electronics, batteries</li>
                            <li><strong>Special Collection:</strong> Custom requirements</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('scheduled_date').value = today;
    
    // Form validation
    const form = document.querySelector('form');
    const customerSelect = document.getElementById('customer_id');
    const serviceTypeSelect = document.getElementById('service_type');
    const descriptionTextarea = document.getElementById('description');
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        let isValid = true;
        
        // Check required fields
        if (!customerSelect.value) {
            customerSelect.classList.add('is-invalid');
            isValid = false;
        } else {
            customerSelect.classList.remove('is-invalid');
        }
        
        if (!serviceTypeSelect.value) {
            serviceTypeSelect.classList.add('is-invalid');
            isValid = false;
        } else {
            serviceTypeSelect.classList.remove('is-invalid');
        }
        
        if (!descriptionTextarea.value.trim()) {
            descriptionTextarea.classList.add('is-invalid');
            isValid = false;
        } else {
            descriptionTextarea.classList.remove('is-invalid');
        }
        
        if (!isValid) {
            e.preventDefault();
            alert('Please fill in all required fields.');
        }
    });
    
    // Auto-fill description based on service type
    serviceTypeSelect.addEventListener('change', function() {
        const descriptions = {
            'pickup': 'Regular garbage pickup service. Please ensure bins are accessible and properly secured.',
            'disposal': 'General waste disposal service. Items should be properly bagged and contained.',
            'recycling': 'Recycling collection service. Please separate recyclables from regular waste.',
            'bulk': 'Bulk item removal service. Large items should be placed in an accessible location.',
            'hazardous': 'Hazardous waste collection. Special handling required for safety compliance.',
            'special': 'Special collection service. Please provide detailed requirements in description.'
        };
        
        if (this.value && descriptions[this.value]) {
            descriptionTextarea.value = descriptions[this.value];
        }
    });
});
</script>
{% endblock %} 